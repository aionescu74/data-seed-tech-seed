<?phprequire_once("../connection.inc");require_once("../counter.inc");//require_once("./constante.inc");//require_once("./ubl_functions.inc");///////////////////////////////////////                FOR              ///////////////////////////////////////$for =	@$_POST['hdnFor'];$msg = "";$err = "";$fast_invoice_id    = @$_POST['fast_invoice_id'];if($fast_invoice_id == ""){    //TBD: temp:    $fast_invoice_id = @$_GET['id'];    if($fast_invoice_id != "")    {            $for = "EDIT";    }}//print ($fast_invoice_id);$fast_client_id         = @$_POST['fast_client_id'];if($fast_client_id == ""){    //$visitor_id vine din counter.inc    $sql = "SELECT * FROM fast_client WHERE visitor_id = '".$visitor_id."';";    //print($sql);    $result = $conn -> query($sql);        //if (mysqli_num_rows($result) === 0 && $visitor_id != "")    //{    //     print("E21. Wrong visitor!");    //     die;    //}    //else    //{        if ($row = $result ->fetch_object())        {            $fast_client_id   = $row->fast_client;            $fast_client_name = $row->fast_client_name;        }        else        {            $fast_client_name = "not registered client";            $sql = "INSERT INTO fast_client VALUES (default, '".$fast_client_name."', ".$visitor_id.");";            //print($sql);            $result = $conn -> query($sql);            $err    = $conn->error;            $fast_client_id = $conn->insert_id;        //}    }}//print $fast_client_id;$fast_reference         = @$_POST['fast_reference'];if($fast_reference == ""){    $fast_reference = "creata in aplicatia fastinvoice.ro";}$ID                     = @$_POST['ID'];$IssueDate              = @$_POST['IssueDate'];$DueDate                = @$_POST['DueDate'];$Note                   = @$_POST['Note'];$DocumentCurrencyCode   = @$_POST['DocumentCurrencyCode'];if($DocumentCurrencyCode == ""){    $DocumentCurrencyCode = "RON";}$InvoicePeriodEndDate   = @$_POST['InvoicePeriodEndDate'];$TaxAmount              = @$_POST['TaxAmount'];if($TaxAmount == ""){    $TaxAmount = 0.00;}$LineExtensionAmount    = @$_POST['LineExtensionAmount'];if($LineExtensionAmount == ""){    $LineExtensionAmount = 0.00;}$TaxExclusiveAmount     = @$_POST['TaxExclusiveAmount'];if($TaxExclusiveAmount == ""){    $TaxExclusiveAmount = 0.00;}$TaxInclusiveAmount     = @$_POST['TaxInclusiveAmount'];if($TaxInclusiveAmount == ""){    $TaxInclusiveAmount = 0.00;}$PayableAmount          = @$_POST['PayableAmount'];if($PayableAmount == ""){    $PayableAmount = 0.00;}$sup = new SupplierParty();$sup->SUPPartyID = @$_POST['fast_supplierparty'];if(!isset($sup->SUPPartyID)){    //print("sss");    $sup->SUPPartyID = "";}//print($sup->SUPPartyID);$sup->SUPPartyName                       = @$_POST['SUPPartyName'];$sup->SUPPartyTaxSchemeCompanyID         = @$_POST['SUPPartyTaxSchemeCompanyID'];$sup->SUPPartyTaxSchemeTaxScheme         = @$_POST['SUPPartyTaxSchemeTaxScheme'];if($sup->SUPPartyTaxSchemeTaxScheme == ""){    $sup->SUPPartyTaxSchemeTaxScheme = "VAT";}$sup->SUPPostalAddressStreetName         = @$_POST['SUPPostalAddressStreetName'];$sup->SUPPostalAddressCityName           = @$_POST['SUPPostalAddressCityName'];$sup->SUPPostalAddressPostalZone         = @$_POST['SUPPostalAddressPostalZone'];$sup->SUPPostalAddressCountrySubentity   = @$_POST['SUPPostalAddressCountrySubentity'];$sup->SUPPostalAddressCountry            = @$_POST['SUPPostalAddressCountry'];if($sup->SUPPostalAddressCountry == ""){    $sup->SUPPostalAddressCountry            = "RO";}$sup->SUPPartyLegalEntityRegistrationName= @$_POST['SUPPartyLegalEntityRegistrationName'];if($sup->SUPPartyLegalEntityRegistrationName == ""){    $sup->SUPPartyLegalEntityRegistrationName = $sup->SUPPartyName;}$sup->SUPPartyLegalEntityCompanyID       = @$_POST['SUPPartyLegalEntityCompanyID'];$sup->SUPCompanyLegalForm                = @$_POST['SUPCompanyLegalForm'];$sup->SUPElectronicMail                  = @$_POST['SUPElectronicMail'];$sup->SUPPlatitorTVA                     = @$_POST['SUPPlatitorTVA'];$cust = new CustomerParty();$cust->CUSTPartyID                         = @$_POST['fast_customerparty'];if(!isset($cust->CUSTPartyID)){    //print("sss");    $cust->CUSTPartyID = "";}//print($cust->CUSTPartyID);$cust->CUSTPartyName                       = @$_POST['CUSTPartyName'];$cust->CUSTfast_platitorTVA                = @$_POST['CUSTfast_platitorTVA'];$cust->CUSTPartyTaxSchemeCompanyID         = @$_POST['CUSTPartyTaxSchemeCompanyID'];$cust->CUSTPartyTaxSchemeTaxScheme         = @$_POST['CUSTPartyTaxSchemeTaxScheme'];if($cust->CUSTPartyTaxSchemeTaxScheme == ""){    $cust->CUSTPartyTaxSchemeTaxScheme = "VAT";}$cust->CUSTPostalAddressStreetName         = @$_POST['CUSTPostalAddressStreetName'];$cust->CUSTPostalAddressCityName           = @$_POST['CUSTPostalAddressCityName'];$cust->CUSTPostalAddressPostalZone         = @$_POST['CUSTPostalAddressPostalZone'];$cust->CUSTPostalAddressCountrySubentity   = @$_POST['CUSTPostalAddressCountrySubentity'];$cust->CUSTPostalAddressCountry            = @$_POST['CUSTPostalAddressCountry'];if($cust->CUSTPostalAddressCountry == ""){    $cust->CUSTPostalAddressCountry            = "RO";}$cust->CUSTPartyLegalEntityRegistrationName= @$_POST['CUSTPartyLegalEntityRegistrationName'];if($cust->CUSTPartyLegalEntityRegistrationName == ""){    $cust->CUSTPartyLegalEntityRegistrationName = $cust->CUSTPartyName;}$cust->CUSTPartyLegalEntityCompanyID       = @$_POST['CUSTPartyLegalEntityCompanyID'];$sup->SUPPayeeFinancialAccountID         = @$_POST['SUPPayeeFinancialAccountID'];$sup->SUPPaymentMeansCode                = @$_POST['SUPPaymentMeansCode'];if($sup->SUPPaymentMeansCode == ""){    $sup->SUPPaymentMeansCode = 31;}if($for == "GET_SUPP"){    $sup->getSupplierParty();}if($for == "GET_CUST"){    $cust->getCustomerParty();}if($for == "SAVE"){    ////////////////////////////////////////////    //              Supplier Party    ////////////////////////////////////////////    if($sup->SUPPartyID == "" && $err == "")    {        $sql = "INSERT INTO fast_supplierparty VALUES (default, '".$sup->SUPPartyName."', ".$fast_client_id.", ".$sup->SUPPlatitorTVA.", '".                $sup->SUPPartyTaxSchemeCompanyID."', '".$sup->SUPPartyTaxSchemeTaxScheme."', '".$sup->SUPPostalAddressStreetName."', '".                $sup->SUPPostalAddressCityName."', '".$sup->SUPPostalAddressPostalZone."', '".$sup->SUPPostalAddressCountrySubentity."', '".                $sup->SUPPostalAddressCountry."', '".$sup->SUPPartyLegalEntityRegistrationName."', '".                $sup->SUPPartyLegalEntityCompanyID."', '".$sup->SUPCompanyLegalForm."', '".$sup->SUPElectronicMail."');";        //print($sql);        $result = $conn -> query($sql);                if($conn->errno == 0)        {            $sup->SUPPartyID = $conn->insert_id;            $err = "";            $msg = "INSERT SUPParty OK";        }        else        {            $err = "EROARE";            $msg = "INSERT SUPParty ERROR: " . $conn->error;            //$msg = "INSERT OK";        }                        ///////////////////////////////////////////        //              Payment Means        ///////////////////////////////////////////        if($sup->SUPPartyID != "" && $err == "")        {            $sql = "INSERT INTO fast_supplier_paymentmeans VALUES (default, " . $sup->SUPPartyID . ", '" . $sup->SUPPaymentMeansCode . "', '" . $sup->SUPPayeeFinancialAccountID ."');";            //print($sql);            $result = $conn -> query($sql);            if($conn->errno == 0)            {                $sup->PaymentMeansID = $conn->insert_id;                $err = "";                $msg = "INSERT PaymentMeans OK";            }            else            {                $err = "EROARE";                $msg = "INSERT PaymentMeans ERROR: " . $conn->error;                //$msg = "INSERT OK";            }        }    }    elseif($sup->SUPPartyID != "" && $err == "")    {        $sql = "UPDATE fast_supplierparty SET PartyName ='".$sup->SUPPartyName."', fast_client='".$fast_client_id."', fast_platitorTVA=".$sup->SUPPlatitorTVA.", "                . "PartyTaxSchemeCompanyID ='".$sup->SUPPartyTaxSchemeCompanyID."', "                . "PartyTaxSchemeTaxScheme ='".$sup->SUPPartyTaxSchemeTaxScheme."', PostalAddressStreetName ='".$sup->SUPPostalAddressStreetName."', PostalAddressCityName ='".$sup->SUPPostalAddressCityName."', "                . "PostalAddressPostalZone='".$sup->SUPPostalAddressPostalZone."', "                . "PostalAddressCountrySubentity ='".$sup->SUPPostalAddressCountrySubentity."', PostalAddressCountry='".$sup->SUPPostalAddressCountry ."', "                . "PartyLegalEntityRegistrationName='".$sup->SUPPartyLegalEntityRegistrationName."', "                . "PartyLegalEntityCompanyID='".$sup->SUPPartyLegalEntityCompanyID."' WHERE fast_id=".$sup->SUPPartyID.";";                        //print($sql);        $result = $conn -> query($sql);        if($conn->errno == 0)        {            $err = "";            $msg = "UPDATE SUPParty OK";        }        else        {            $err = "EROARE";            $msg = "UPDATE SUPParty ERROR: " . $conn->error;            //$msg = "INSERT OK";        }                        ///////////////////////////////////////////        //              Payment Means        ///////////////////////////////////////////        if($err == "")        {            $sql = "UPDATE fast_supplier_paymentmeans SET PaymentMeansCode = '" . $sup->SUPPaymentMeansCode . "', PayeeFinancialAccountID = '" . $sup->SUPPayeeFinancialAccountID ."' WHERE fast_supplier_id =".$sup->SUPPartyID.";";            //print($sql);            $result = $conn -> query($sql);            if($conn->errno == 0)            {                $err = "";                $msg = "UPDATE PaymentMeans OK";            }            else            {                $err = "EROARE";                $msg = "UPDATE PaymentMeans ERROR: " . $conn->error;                //$msg = "INSERT OK";            }        }    }            ////////////////////////////////////////////    //              Customer Party    ////////////////////////////////////////////    if($cust->CUSTPartyID == "" && $err == "")    {        $sql = "INSERT INTO fast_customerparty VALUES (default, '".$cust->CUSTPartyName."', ".$fast_client_id.", '".                $cust->CUSTPartyTaxSchemeCompanyID."', '".$cust->CUSTPartyTaxSchemeTaxScheme."', '".$cust->CUSTPostalAddressStreetName."', '".                $cust->CUSTPostalAddressCityName."', '".$cust->CUSTPostalAddressPostalZone."', '".$cust->CUSTPostalAddressCountrySubentity."', '".                $cust->CUSTPostalAddressCountry."', '".$cust->CUSTPartyLegalEntityRegistrationName."', '".                $cust->CUSTPartyLegalEntityCompanyID."');";        //print($sql);        $result = $conn -> query($sql);                if($conn->errno == 0)        {            $cust->CUSTPartyID = $conn->insert_id;            $msg = "INSERT CUSTParty OK";        }        else        {            $msg = "INSERT CUSTParty ERROR: " . $conn->error;            //$msg = "INSERT OK";        }    }    elseif($cust->CUSTPartyID != "" && $err == "")    {        $sql = "UPDATE fast_customerparty SET PartyName ='".$cust->CUSTPartyName."', fast_client='".$fast_client_id."', PartyTaxSchemeCompanyID ='".$cust->CUSTPartyTaxSchemeCompanyID."', "                . "PartyTaxSchemeTaxScheme ='".$cust->CUSTPartyTaxSchemeTaxScheme."', PostalAddressStreetName ='".$cust->CUSTPostalAddressStreetName."', PostalAddressCityName ='".$cust->CUSTPostalAddressCityName."', "                . "PostalAddressPostalZone='".$cust->CUSTPostalAddressPostalZone."', "                . "PostalAddressCountrySubentity ='".$cust->CUSTPostalAddressCountrySubentity."', PostalAddressCountry='".$cust->CUSTPostalAddressCountry ."', "                . "PartyLegalEntityRegistrationName='".$cust->CUSTPartyLegalEntityRegistrationName."', "                . "PartyLegalEntityCompanyID='".$cust->CUSTPartyLegalEntityCompanyID."' WHERE fast_id=".$cust->CUSTPartyID.";";                        //print($sql);        $result = $conn -> query($sql);        $err    = $conn->error;                $msg = "UPDATE CUSTParty OK";    }            ////////////////////////////////////////////    //                  Invoice    ////////////////////////////////////////////    if(($fast_invoice_id == "" || $fast_invoice_id == 0) && $err == "")    //if((empty($fast_invoice_id) || isset($fast_invoice_id)) && $msg == "")    {        //print("INSERT");        //////////////////////////////////////////////////////////////////////////////////////////        //                                  INSERT                                              //        //////////////////////////////////////////////////////////////////////////////////////////        $sql = "INSERT INTO fast_invoice VALUES (default, ".$fast_client_id.", '".$fast_reference."', '".$ID."', ".$sup->SUPPartyID.", ".$cust->CUSTPartyID.", "                . "'".$IssueDate."', '".$DueDate."', '".$Note."', '".$DocumentCurrencyCode."', '".$InvoicePeriodEndDate."', "                .$TaxAmount .", ".$LineExtensionAmount.", ".$TaxExclusiveAmount.", ".$TaxInclusiveAmount.", ".$PayableAmount.");";        //print($sql);        $result = $conn -> query($sql);        if($conn->errno == 0)        {            $fast_invoice_id = $conn->insert_id;            //print($fast_invoice_id);            $msg = "INSERT OK";        }        else        {            $msg = "INSERT INVOICE ERROR: " . $conn->error;            //$msg = "INSERT OK";        }    }    elseif(($fast_invoice_id != "" && $fast_invoice_id != 0) && $err == "")    {        $sql = "UPDATE fast_invoice SET ID='".$ID."', fast_supplierparty='".$sup->SUPPartyID."', fast_customerparty='".$cust->CUSTPartyID."', "                . "IssueDate='".$IssueDate."', DueDate='".$DueDate."', Note='".$Note."', DocumentCurrencyCode='".$DocumentCurrencyCode."', "                . "InvoicePeriodEndDate='".$InvoicePeriodEndDate."', TaxAmount=".$TaxAmount .", LineExtensionAmount=".$LineExtensionAmount.", "                . "TaxExclusiveAmount=".$TaxExclusiveAmount.", TaxInclusiveAmount=".$TaxInclusiveAmount.", PayableAmount=".$PayableAmount                ." WHERE fast_id=".$fast_invoice_id.";";        //print($sql);        $result = $conn -> query($sql);        $err    = $conn->error;                $msg = "UPDATE OK";    }}if($for == "EDIT"){    $sql = "SELECT * FROM fast_invoice where fast_id = " . $fast_invoice_id . ";";    $result = $conn -> query($sql);        if ($row = $result ->fetch_object())    {        $ID                     = $row->ID;        $IssueDate              = $row->IssueDate;        $DueDate                = $row->DueDate;        $Note                   = $row->Note;        $DocumentCurrencyCode   = $row->DocumentCurrencyCode;        $InvoicePeriodEndDate   = $row->InvoicePeriodEndDate;        $TaxAmount              = $row->TaxAmount;        $LineExtensionAmount    = $row->LineExtensionAmount;        $TaxExclusiveAmount     = $row->TaxExclusiveAmount;        $TaxInclusiveAmount     = $row->TaxInclusiveAmount;        $PayableAmount          = $row->PayableAmount;        $sup->SUPPartyID             = $row->fast_supplierparty;        $cust->CUSTPartyID            = $row->fast_customerparty;    }            ///////////////////////////////////////////    //              Supplier Party    ///////////////////////////////////////////    //$sql = "SELECT * FROM fast_supplierparty WHERE fast_id =".$sup->SUPPartyID.";";    //print($sql);    //$result = $conn -> query($sql);        //if ($row = $result ->fetch_object())    //{    //    $SUPPartyName                       = $row->PartyName;        //$SUPfast_client_id                = $row->fast_client_id;        ///////// TBD: verificare client    //    $SUPPlatitorTVA                = $row->fast_platitorTVA;    //    $SUPPartyTaxSchemeCompanyID         = $row->PartyTaxSchemeCompanyID;    //    $SUPPartyTaxSchemeTaxScheme         = $row->PartyTaxSchemeTaxScheme;    //    $SUPPostalAddressStreetName         = $row->PostalAddressStreetName;    //    $SUPPostalAddressCityName           = $row->PostalAddressCityName;        //$SUPPostalAddressPostalZone         = $row->PostalAddressPostalZone;    //    $SUPPostalAddressCountrySubentity   = $row->PostalAddressCountrySubentity;    //    $SUPPostalAddressCountry            = $row->PostalAddressCountry;    //    $SUPPartyLegalEntityRegistrationName= $row->PartyLegalEntityRegistrationName;    //    $SUPPartyLegalEntityCompanyID       = $row->PartyLegalEntityCompanyID;        //$SUPCompanyLegalForm              = $row->CompanyLegalForm;        //$SUPElectronicMail                = $row->ElectronicMail;    //}    $sup->getSupplierParty();            ///////////////////////////////////////////    //              Payment Means    ///////////////////////////////////////////    //$sql = "SELECT * FROM fast_supplier_paymentmeans WHERE fast_supplier_id =".$Ssup->UPPartyID.";";    //print($sql);    //$result = $conn -> query($sql);    //if ($row = $result ->fetch_object())    //{    //    $SUPPayeeFinancialAccountID = $row->PayeeFinancialAccountID;    //    $SUPPaymentMeansCode        = $row->PaymentMeansCode;    //}            ///////////////////////////////////////////    //              Customer Party    ///////////////////////////////////////////    //$sql = "SELECT * FROM fast_customerparty WHERE fast_id =".$cust->CUSTPartyID.";";    //print($sql);    //$result = $conn -> query($sql);        //if ($row = $result ->fetch_object())    //{    //    $CUSTPartyName                       = $row->PartyName;        //$CUSTfast_client_id                = $row->fast_client_id;        ///////// TBD: verificare client    //    $CUSTPartyTaxSchemeCompanyID         = $row->PartyTaxSchemeCompanyID;    //    $CUSTPartyTaxSchemeTaxScheme         = $row->PartyTaxSchemeTaxScheme;    //    $CUSTPostalAddressStreetName         = $row->PostalAddressStreetName;    //    $CUSTPostalAddressCityName           = $row->PostalAddressCityName;        //$CUSTPostalAddressPostalZone         = $row->PostalAddressPostalZone;    //    $CUSTPostalAddressCountrySubentity   = $row->PostalAddressCountrySubentity;    //    $CUSTPostalAddressCountry            = $row->PostalAddressCountry;    //    $CUSTPartyLegalEntityRegistrationName= $row->PartyLegalEntityRegistrationName;    //    $CUSTPartyLegalEntityCompanyID       = $row->PartyLegalEntityCompanyID;    //}    $cust->getCustomerParty();}class SupplierParty{    public $SUPPartyID;    public $SUPPartyName;    public $SUPPlatitorTVA;    public $SUPPartyTaxSchemeCompanyID;    public $SUPPartyTaxSchemeTaxScheme;    public $SUPPostalAddressStreetName;    public $SUPPostalAddressCityName;    public $SUPPostalAddressCountrySubentity;    public $SUPPostalAddressCountry;    public $SUPPartyLegalEntityRegistrationName;    public $SUPPartyLegalEntityCompanyID;        public $SUPPaymentMeansCode;    public $SUPPayeeFinancialAccountID;                            function getSupplierParty()    {        global $conn;        if($this->SUPPartyID != "")        {            $sql = "SELECT * FROM fast_supplierparty WHERE fast_id =".$this->SUPPartyID.";";            //print($sql);            $result = $conn -> query($sql);            if ($row = $result ->fetch_object())            {                $this->SUPPartyName                       = $row->PartyName;                //$SUPfast_client_id                = $row->fast_client_id;                ///////// TBD: verificare client                $this->SUPPlatitorTVA                = $row->fast_platitorTVA;                $this->SUPPartyTaxSchemeCompanyID   = $row->PartyTaxSchemeCompanyID;                $this->SUPPartyTaxSchemeTaxScheme         = $row->PartyTaxSchemeTaxScheme;                $this->SUPPostalAddressStreetName         = $row->PostalAddressStreetName;                $this->SUPPostalAddressCityName           = $row->PostalAddressCityName;                //$this->SUPPostalAddressPostalZone         = $row->PostalAddressPostalZone;                $this->SUPPostalAddressCountrySubentity   = $row->PostalAddressCountrySubentity;                $this->SUPPostalAddressCountry            = $row->PostalAddressCountry;                $this->SUPPartyLegalEntityRegistrationName= $row->PartyLegalEntityRegistrationName;                $this->SUPPartyLegalEntityCompanyID       = $row->PartyLegalEntityCompanyID;                //$this->SUPCompanyLegalForm              = $row->CompanyLegalForm;                //$this->SUPElectronicMail                = $row->ElectronicMail;            }                        $sql = "SELECT * FROM fast_supplier_paymentmeans WHERE fast_supplier_id =".$this->SUPPartyID.";";            //print($sql);            $result = $conn -> query($sql);            if ($row = $result ->fetch_object())            {                $this->SUPPayeeFinancialAccountID = $row->PayeeFinancialAccountID;                $this->SUPPaymentMeansCode        = $row->PaymentMeansCode;            }        }        else        {            $this->SUPPartyName                       = "";            //$this->SUPfast_client_id                = "";            ///////// TBD: verificare client            $this->SUPPlatitorTVA                     = 1;            $this->SUPPartyTaxSchemeCompanyID         = "";            $this->SUPPartyTaxSchemeTaxScheme         = "";            $this->SUPPostalAddressStreetName         = "";            $this->SUPPostalAddressCityName           = "";            //$this->SUPPostalAddressPostalZone         = "";            $this->SUPPostalAddressCountrySubentity   = "";            $this->SUPPostalAddressCountry            = "";            $this->SUPPartyLegalEntityRegistrationName= "";            $this->SUPPartyLegalEntityCompanyID       = "";            //$this->SUPCompanyLegalForm              = "";            //$this->SUPElectronicMail                = "";                        $this->SUPPayeeFinancialAccountID = "";             $this->SUPPaymentMeansCode        = "";        }    }}class CustomerParty{    public $CUSTPartyID;    public $CUSTPartyName;    public $CUSTPartyTaxSchemeCompanyID;    public $CUSTPartyTaxSchemeTaxScheme;    public $CUSTPostalAddressStreetName;    public $CUSTPostalAddressCityName;    //public $CUSTPostalAddressPostalZone;    public $CUSTPostalAddressCountrySubentity;    public $CUSTPostalAddressCountry;    public $CUSTPartyLegalEntityRegistrationName;    public $CUSTPartyLegalEntityCompanyID;                                function getCustomerParty()    {        global $conn;        if($this->CUSTPartyID != "")        {            $sql = "SELECT * FROM fast_customerparty WHERE fast_id =".$this->CUSTPartyID.";";            //print($sql);            $result = $conn -> query($sql);            if ($row = $result ->fetch_object())            {                $this->CUSTPartyName                       = $row->PartyName;                //$this->CUSTfast_client_id                = $row->fast_client_id;                ///////// TBD: verificare client                $this->CUSTPartyTaxSchemeCompanyID         = $row->PartyTaxSchemeCompanyID;                $this->CUSTPartyTaxSchemeTaxScheme         = $row->PartyTaxSchemeTaxScheme;                $this->CUSTPostalAddressStreetName         = $row->PostalAddressStreetName;                $this->CUSTPostalAddressCityName           = $row->PostalAddressCityName;                //$this->CUSTPostalAddressPostalZone         = $row->PostalAddressPostalZone;                $this->CUSTPostalAddressCountrySubentity   = $row->PostalAddressCountrySubentity;                $this->CUSTPostalAddressCountry            = $row->PostalAddressCountry;                $this->CUSTPartyLegalEntityRegistrationName= $row->PartyLegalEntityRegistrationName;                $this->CUSTPartyLegalEntityCompanyID       = $row->PartyLegalEntityCompanyID;            }        }        else        {            $this->CUSTPartyName                       = "";            //$this->CUSTfast_client_id                = $row->fast_client_id;            ///////// TBD: verificare client            $this->CUSTPartyTaxSchemeCompanyID         = "";            $this->CUSTPartyTaxSchemeTaxScheme         = "";            $this->CUSTPostalAddressStreetName         = "";            $this->CUSTPostalAddressCityName           = "";            //$this->CUSTPostalAddressPostalZone         = "";            $this->CUSTPostalAddressCountrySubentity   = "";            $this->CUSTPostalAddressCountry            = "";            $this->CUSTPartyLegalEntityRegistrationName= "";            $this->CUSTPartyLegalEntityCompanyID       = "";        }    }}?><html lang="RO"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Generare XML pentru sistemul e-factura</title><meta name="description" content="Generare rapidă UBL pentru sistemul e-factura"/><!--link rel="shortcut icon" href="./favicon.ico" /--><link name="author" content="dataseed.info" /><link rel="stylesheet" type="text/css" href="./styles.css"><script type="text/javascript" src="./scripturi.js"></script><script language=javascript>function Save(){    if(document.frmForm.ID.value === "")    //if(document.getElementsByName("ID").value === undefined)    {        alert("EROARE! Completați numărul facturii!");        document.frmForm.ID.focus();        return;    }    if(document.frmForm.IssueDate.value === "")    {        alert("EROARE! Completați data facturii!");        document.frmForm.IssueDate.focus();        return;    }    if(document.frmForm.SUPPayeeFinancialAccountID.value === "")    {        alert("EROARE! Completați IBAN-ul furnizorului!");        document.frmForm.SUPPayeeFinancialAccountID.focus();        return;    }        document.frmForm.hdnFor.value = "SAVE";    document.frmForm.submit();}function AddNew(){    //document.frmForm..value = "";    //document.getElementById("frmForm").reset();    var elements = frmForm.elements;    for(i=0; i<elements.length; i++)     {        field_type = elements[i].type.toLowerCase();        switch(field_type)        {            case "text":            case "number":            case "textarea":            case "hidden":                elements[i].value = "";                break;            case "select-one":            case "select-multi":                elements[i].selectedIndex = -1;                break;            default:                  break;        }    }    //alert(window.location.href);    //alert('fast_id=1');    //txt = window.location.href;    //res = txt.replace('fast_id=1', 'fast_id=');    //alert(res);    //document.frmForm.action = res;    //document.frmForm.reset();    document.frmForm.hdnFor.value = "ADDNEW";    document.frmForm.submit();}function item(i){    //alert(i);    document.frmForm.ID.value = '<?php print($fast_invoice_id) ?>';    document.frmForm.method = "post";    document.frmForm.action = "item.php";    if(i === "" || i === undefined)    {        document.frmForm.hdnFor.value = "ADDNEW";    }    else    {        document.frmForm.fast_item_id.value = i;        document.frmForm.hdnFor.value = "EDIT";    }    //alert(document.frmForm.hdnFor.value);    document.frmForm.submit();}function supp(){    document.frmForm.hdnFor.value = "GET_SUPP";    document.frmForm.method = "post";    document.frmForm.submit();}function cust(){    document.frmForm.hdnFor.value = "GET_CUST";    document.frmForm.method = "post";    document.frmForm.submit();}$ = function(id) {  return document.getElementById(id);}var show = function(id) {	$(id).style.display ='block';}var hide = function(id) {	$(id).style.display ='none';}</script></head><body onload="start(<?php print($visitor_id); ?>)"><div class="header">    <h1><a href="./" class="header">&#127968; fastinvoice.ro</a>        &nbsp;&nbsp;>&nbsp; &#128196; Adăugare factură</div>    <div class="container"><div class="top_menu">        <a href="./">&#127968; Home</a>&nbsp;     | &nbsp;    <a href="./entityView.php?app=_system&table=seed_apps ">&#9881; Apps</a>&nbsp;     | &nbsp;         <a target="_blank" href="https://data-seed.tech/tutorial.php">&#128712; Help</a>          </div><br><br><div class="invoice"><form name='frmForm' method='post'><table class="form_table"><tr>    <td style="text-align:center;background-color: #e6f2ff" colspan="5">        <h1 style="font-size:16px">            FACTURA NR. &nbsp;            <input type="text" id="ID" name="ID" value="<?php print($ID) ?>" placeholder="Nr. fact." maxlength="100" style="width:80px;font-weight:bold;font-size:16px" title="Numărul facturii în evidențele dumneavoastră - acesta este de obicei transmis clientului ca Număr factură (ANAF: BT-1)">            &nbsp;&nbsp;            din data <input type="date" name="IssueDate" value="<?php print($IssueDate) ?>" title="Data emiterii facturii (ANAF: BT-2)" style="font-size:16px">        </h1>        <br/>    </td></tr><tr>    <td style="text-align:center" colspan="5">        <?php print($msg); ?><?php print($err); ?>    </td></tr><tr>    <td>Data scadenței *</td>    <td><input type="date" name="DueDate" value="<?php print($DueDate) ?>" title="Data la care trebuie efectuată plata (ANAF: BT-9)"></td>    <td></td>    <td>Moneda facturii - Codul monedei (ANAF: BT-5) *</td>    <td>        <select name="DocumentCurrencyCode">            <option value="RON" <?php if($DocumentCurrencyCode == "RON") {print("selected");} ?>>RON</option>            <option value="EUR" <?php if($DocumentCurrencyCode == "EUR") {print("selected");} ?>>EUR</option>        </select>    </td></tr><tr>    <td style="font-weight:bold">Invoice fast_id 🔑 </td>    <td><input type="number" name="fast_invoice_id" value="<?php print($fast_invoice_id) ?>" style="width:50px;text-align: right;" readonly class="read_only"> hidden</td>    <td></td>    <td>fast_client id *</td>    <td>        <input type="number" name="fast_client_id" value="<?php print($fast_client_id) ?>" style="width:50px; text-align: right;"> hidden FastInvoice Client Id    </td></tr><tr>    <td style="text-align:center;background-color: #e6f2ff" colspan="2">        <h3>FURNIZOR &nbsp;                <?php        if($fast_client_id != "")        {            $query = "SELECT *                    FROM fast_supplierparty                    WHERE fast_client = ".$fast_client_id.";";            //print($query);            $result = $conn -> query($query);            if (mysqli_num_rows($result) > 0)            {                ?>            <select name="fast_supplierparty" onchange="supp();">                    <option value="" style="color:gray"> -- Furnizori salvați -- </option>                    <?php                    while($row = $result -> fetch_object())                    {                    ?>                    <option value="<?php print($row->fast_id) ?>" <?php if($sup->SUPPartyID == $row->fast_id) {print("selected");} ?>><?php print($row->PartyName) ?></option>                    <?php                    }                    ?>                </select>            <?php            }        }        ?>            </h3>    </td>    <td>&nbsp;</td>    <td style="text-align:center;background-color: #e6f2ff" colspan="2">        <h3>CLIENT &nbsp;                <?php        if($fast_client_id != "")        {            $query = "SELECT *                    FROM fast_customerparty                    WHERE fast_client = ".$fast_client_id.";";            //print($query);            $result = $conn -> query($query);            if (mysqli_num_rows($result) > 0)            {                ?>                <select name="fast_customerparty" onchange="cust();">                    <option value="" style="color:gray"> -- Clienți salvați -- </option>                    <?php                    while($row = $result -> fetch_object())                    {                    ?>                    <option value="<?php print($row->fast_id) ?>" <?php if($cust->CUSTPartyID == $row->fast_id) {print("selected");} ?>><?php print($row->PartyName) ?></option>                    <?php                    }                    ?>                </select>            <?php            }        }        ?>                    </h3>    </td></tr><tr>    <td>        Denumire furnizor:    </td>    <td>        <input type="text" name="SUPPartyName" value="<?php print($sup->SUPPartyName) ?>" placeholder="Denumire furnizor" maxlength="100" style="width:200px">    </td>    <td>&nbsp;</td>    <td>        Denumire client:    </td>    <td>        <input type="text" name="CUSTPartyName" value="<?php print($cust->CUSTPartyName) ?>" placeholder="Denumire client" maxlength="100" style="width:200px">    </td></tr><tr>    <td>        CUI:    </td>    <td>        <input type="text" name="SUPPartyTaxSchemeCompanyID" value="<?php print($sup->SUPPartyTaxSchemeCompanyID) ?>" placeholder="ex. RO12345678" maxlength="10" style="width:200px">        &nbsp;        [<a target="_blank" title="Se autocompletează datele dacă compania este găsită în sistemul ANAF" href="#">Verifică în sistemul ANAF</a>]    </td>    <td>&nbsp;</td>    <td>        CUI:    </td>    <td>        <input type="text" name="CUSTPartyTaxSchemeCompanyID" value="<?php print($cust->CUSTPartyTaxSchemeCompanyID) ?>" placeholder="ex. RO12345678" maxlength="10" style="width:200px">        &nbsp;        [<a target="_blank" title="Se autocompletează datele dacă compania este găsită în sistemul ANAF" href="#">Verifică în sistemul ANAF</a>]    </td></tr><tr>    <td>        Reg. Com.:    </td>    <td>        <input type="text" name="SUPPartyLegalEntityCompanyID" value="<?php print($sup->SUPPartyLegalEntityCompanyID) ?>" placeholder="ex.  Fxx/1234/2023" maxlength="13" style="width:200px">    </td>    <td>&nbsp;</td>    <td>        Reg. Com.:    </td>    <td>        <input type="text" name="CUSTPartyLegalEntityCompanyID" value="<?php print($cust->CUSTPartyLegalEntityCompanyID) ?>" placeholder="ex.  Jxx/1234/2023" maxlength="13" style="width:200px">    </td></tr><tr>    <td>        Adresa:    </td>    <td>        <?php        $query = "SELECT *                FROM fast_countrysubentity;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="SUPPostalAddressCountrySubentity">            <option value="" style="color:gray"> -- Județ -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->CountrySubentity) ?>" <?php if($sup->SUPPostalAddressCountrySubentity == $row->CountrySubentity) {print("selected");} ?>><?php print($row->Subentity) ?></option>            <?php            }            ?>        </select>                <input type="text" name="SUPPostalAddressCityName" value="<?php print($sup->SUPPostalAddressCityName) ?>" placeholder="Localitate" maxlength="100" style="width:200px"><br/>        <input type="text" name="SUPPostalAddressStreetName" value="<?php print($sup->SUPPostalAddressStreetName) ?>" placeholder="Strada" maxlength="300" style="width:300px">    </td>    <td>&nbsp;</td>    <td>        Adresa:    </td>    <td>        <?php        $query = "SELECT *                FROM fast_countrysubentity;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="CUSTPostalAddressCountrySubentity">            <option value="" style="color:gray"> -- Județ -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->CountrySubentity) ?>" <?php if($cust->CUSTPostalAddressCountrySubentity == $row->CountrySubentity) {print("selected");} ?>><?php print($row->Subentity) ?></option>            <?php            }            ?>        </select>                <input type="text" name="CUSTPostalAddressCityName" value="<?php print($cust->CUSTPostalAddressCityName) ?>" placeholder="Localitate" maxlength="100" style="width:200px"><br/>        <input type="text" name="CUSTPostalAddressStreetName" value="<?php print($cust->CUSTPostalAddressStreetName) ?>" placeholder="Strada" maxlength="300" style="width:300px">    </td></tr><tr>    <td>        IBAN / Metoda de plată:    </td>    <td>        <input type="text" name="SUPPayeeFinancialAccountID" value="<?php print($sup->SUPPayeeFinancialAccountID) ?>" placeholder="IBAN: ex. ROxxBANKxxxxxxxxxxxxxxxx" maxlength="20" style="width:200px">                <?php        $query = "SELECT *                FROM fast_paymentmeans;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="SUPPaymentMeansCode">            <option value="" style="color:gray"> -- Metoda de plată -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->PaymentMeanCode) ?>" <?php if($sup->SUPPaymentMeansCode == $row->PaymentMeanCode) {print("selected");} ?>><?php print($row->PaymentMeanCode . " - " . $row->PaymentMean) ?></option>            <?php            }            ?>        </select>            </td>    <td colspan="3">&nbsp;</td></tr><tr>    <td>        Plătitor de TVA    </td>    <td>        <select name="SUPPlatitorTVA">            <option value="1" <?php if($sup->SUPPlatitorTVA == 1) {print("selected");} ?>>DA</option>            <option value="0" <?php if($sup->SUPPlatitorTVA == 0) {print("selected");} ?>>NU</option>        </select>    </td>    <td>&nbsp;</td>    <td>Observații</td>    <td>        <textarea name="Note" rows="2" cols="40" placeholder="Aici se pot pune orice informații relevante: cursul valutar etc. Ex. 1 EURO = 4,9746 Lei"><?php print($Note); ?></textarea>    </td></tr> <?phpif($fast_invoice_id != "" && $fast_invoice_id != 0){    $sql = "SELECT `fast_id`, `InvoicedQuantity`, `PriceAmount`,                     InvoicedQuantity*PriceAmount as Valoare, LineExtensionAmount,                     ClassifiedTaxCategoryPercent, (ClassifiedTaxCategoryPercent/100) * InvoicedQuantity * PriceAmount as ValoareTVA            FROM `fast_invoiceline`            where `fast_invoice_id` =" . $fast_invoice_id . ";";    $result = $conn -> query($sql);    if($row = $result->fetch_object())    {    ?>    <tr>        <td colspan="5">&nbsp;</td>    </tr>    <tr>        <td>Valoare netă *</td>        <td><input type="number" name="LineExtensionAmount" value="<?php print($LineExtensionAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Suma valorilor nete ale liniilor facturii"></td>        <td></td>        <td>Valoarea totală a facturii fără TVA *</td>        <td><input type="number" name="TaxExclusiveAmount" value="<?php print($TaxExclusiveAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea totală a facturii fără TVA"></td>    </tr>    <tr>        <td>Valoarea totală a facturii cu TVA *</td>        <td><input type="number" name="TaxInclusiveAmount" value="<?php print($TaxInclusiveAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea totală a facturii cu TVA"></td>        <td></td>        <td>Valoarea TVA totală *</td>        <td><input type="number" name="TaxAmount" value="<?php print($TaxAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea TVA totală a facturii în moneda de contabilizare"></td>    </tr>    <tr>        <td>Total de plată *</td>        <td><input type="number" name="PayableAmount" value="<?php print($PayableAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Total de plată"></td>        <td colspan=""3></td>    </tr>    <?php    }}?><tr>    <td colspan="5">&nbsp;</td></tr><tr>    <td colspan="5">        <table class="xml_table">            <tr>                <th>Nr. crt.</th>                <th>Denumire</th>                <th>Cantitate</th>                <th>U.M.</th>                <th>Preț unitar</th>                <th>Valoare fără TVA</th>                <th>Procent TVA</th>                <th>Valoare TVA</th>            </tr>            <?php            if($fast_invoice_id != "" && $fast_invoice_id != 0)            {                $sql = "SELECT * FROM fast_invoiceline WHERE fast_invoice_id = " . $fast_invoice_id . ";";                $result = $conn -> query($sql);                while($row = $result ->fetch_object())                {                ?>                <tr>                    <td><a target="_self" title="Editare linie <?php print($row->fast_id); ?>" href="#" onclick="item(<?php print($row->fast_id);?>)">↪ <?php print($row->ID);?></a></td>                    <td><?php print($row->ItemName);?></td>                    <td><?php print($row->InvoicedQuantity);?></td>                    <td><?php print($row->InvoicedQuantityUnitCode);?></td>                    <td><?php print($row->PriceAmount);?></td>                    <td><?php print($row->LineExtensionAmount);?></td>                    <td><?php print($row->ClassifiedTaxCategoryPercent);?> %</td>                    <td><?php print($row->InvoicedQuantity * $row->PriceAmount * $row->ClassifiedTaxCategoryPercent / 100);?></td>                </tr>                <?php                }            }            ?>        </table>                <input type="button" name="btnAdd" class='button' onclick='item()' value=' Adaugă item ' <?php if($fast_invoice_id == "" && $fast_invoice_id == 0){print("disabled");}?>>        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <br/><br/><br/>        </td></tr></table>                <br /><br />    <input type="button" name="btnAddNew" onclick="AddNew()" VALUE=" Golește formularul  &#128396;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <input type="button" name="btnSave" class='button_default' onclick='Save()' value=' Salvează factura  &#128190;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <input type="hidden" name="hdnFor">    <input type="hidden" name="fast_item_id"></form><br/><br/><br/></div><?php require_once("footer.inc"); ?></div>    </body></html>