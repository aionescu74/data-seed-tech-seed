<?phprequire_once("../connection.inc");//require_once("../counter.inc");//require_once("./constante.inc");//require_once("./ubl_functions.inc");///////////////////////////////////////                FOR              ///////////////////////////////////////$for =	@$_POST['hdnFor'];if($for == ""){    $for = @$_GET['for'];}//print($for);$msg = '';$fast_invoice_id        = @$_POST['fast_invoice_id'];$fast_client_id         = @$_POST['fast_client_id'];if($fast_client_id == ""){    $fast_client_id = 1;}//print $fast_client_id;$fast_reference         = @$_POST['fast_reference'];if($fast_reference == ""){    $fast_reference = "creata in aplicatia fastinvoice.ro";}$ID                     = @$_POST['ID'];$IssueDate              = @$_POST['IssueDate'];$DueDate                = @$_POST['DueDate'];$Note                   = @$_POST['Note'];$DocumentCurrencyCode   = @$_POST['DocumentCurrencyCode'];if($DocumentCurrencyCode == ""){    $DocumentCurrencyCode = "RON";}$InvoicePeriodEndDate   = @$_POST['InvoicePeriodEndDate'];$TaxAmount              = @$_POST['TaxAmount'];if($TaxAmount == ""){    $TaxAmount = 0.00;}$LineExtensionAmount    = @$_POST['LineExtensionAmount'];if($LineExtensionAmount == ""){    $LineExtensionAmount = 0.00;}$TaxExclusiveAmount     = @$_POST['TaxExclusiveAmount'];if($TaxExclusiveAmount == ""){    $TaxExclusiveAmount = 0.00;}$TaxInclusiveAmount     = @$_POST['TaxInclusiveAmount'];if($TaxInclusiveAmount == ""){    $TaxInclusiveAmount = 0.00;}$PayableAmount          = @$_POST['PayableAmount'];if($PayableAmount == ""){    $PayableAmount = 0.00;}$SUPPartyID                         = @$_POST['fast_supplierparty'];//print($SUPPartyID);$SUPPartyName                       = @$_POST['SUPPartyName'];$SUPfast_platitorTVA                = @$_POST['SUPfast_platitorTVA'];$SUPPartyTaxSchemeCompanyID         = @$_POST['SUPPartyTaxSchemeCompanyID'];$SUPPartyTaxSchemeTaxScheme         = @$_POST['SUPPartyTaxSchemeTaxScheme'];if($SUPPartyTaxSchemeTaxScheme == ""){    $SUPPartyTaxSchemeTaxScheme = "VAT";}$SUPPostalAddressStreetName         = @$_POST['SUPPostalAddressStreetName'];$SUPPostalAddressCityName           = @$_POST['SUPPostalAddressCityName'];$SUPPostalAddressPostalZone         = @$_POST['SUPPostalAddressPostalZone'];$SUPPostalAddressCountrySubentity   = @$_POST['SUPPostalAddressCountrySubentity'];$SUPPostalAddressCountry            = @$_POST['SUPPostalAddressCountry'];if($SUPPostalAddressCountry == ""){    $SUPPostalAddressCountry            = "RO";}$SUPPartyLegalEntityRegistrationName= @$_POST['SUPPartyLegalEntityRegistrationName'];if($SUPPartyLegalEntityRegistrationName == ""){    $SUPPartyLegalEntityRegistrationName = $SUPPartyName;}$SUPPartyLegalEntityCompanyID       = @$_POST['SUPPartyLegalEntityCompanyID'];$SUPCompanyLegalForm                = @$_POST['SUPCompanyLegalForm'];$SUPElectronicMail                  = @$_POST['SUPElectronicMail'];$SUPPlatitorTVA                     = @$_POST['SUPPlatitorTVA'];$CUSTPartyID                         = @$_POST['fast_customerparty'];//print($CUSTPartyID);$CUSTPartyName                       = @$_POST['CUSTPartyName'];$CUSTfast_platitorTVA                = @$_POST['CUSTfast_platitorTVA'];$CUSTPartyTaxSchemeCompanyID         = @$_POST['CUSTPartyTaxSchemeCompanyID'];$CUSTPartyTaxSchemeTaxScheme         = @$_POST['CUSTPartyTaxSchemeTaxScheme'];if($CUSTPartyTaxSchemeTaxScheme == ""){    $CUSTPartyTaxSchemeTaxScheme = "VAT";}$CUSTPostalAddressStreetName         = @$_POST['CUSTPostalAddressStreetName'];$CUSTPostalAddressCityName           = @$_POST['CUSTPostalAddressCityName'];$CUSTPostalAddressPostalZone         = @$_POST['CUSTPostalAddressPostalZone'];$CUSTPostalAddressCountrySubentity   = @$_POST['CUSTPostalAddressCountrySubentity'];$CUSTPostalAddressCountry            = @$_POST['CUSTPostalAddressCountry'];if($CUSTPostalAddressCountry == ""){    $CUSTPostalAddressCountry            = "RO";}$CUSTPartyLegalEntityRegistrationName= @$_POST['CUSTPartyLegalEntityRegistrationName'];if($CUSTPartyLegalEntityRegistrationName == ""){    $CUSTPartyLegalEntityRegistrationName = $CUSTPartyName;}$CUSTPartyLegalEntityCompanyID       = @$_POST['CUSTPartyLegalEntityCompanyID'];$SUPPayeeFinancialAccountID         = @$_POST['SUPPayeeFinancialAccountID'];$SUPPaymentMeansCode                = @$_POST['SUPPaymentMeansCode'];if($SUPPaymentMeansCode == ""){    $SUPPaymentMeansCode = 31;}if($for == "SAVE"){    if($SUPPartyID == "" || $msg = "")    {        $sql = "INSERT INTO fast_supplierparty VALUES (default, '".$SUPPartyName."', ".$fast_client_id.", ".$SUPPlatitorTVA.", '".                $SUPPartyTaxSchemeCompanyID."', '".$SUPPartyTaxSchemeTaxScheme."', '".$SUPPostalAddressStreetName."', '".                $SUPPostalAddressCityName."', '".$SUPPostalAddressPostalZone."', '".$SUPPostalAddressCountrySubentity."', '".                $SUPPostalAddressCountry."', '".$SUPPartyLegalEntityRegistrationName."', '".                $SUPPartyLegalEntityCompanyID."', '".$SUPCompanyLegalForm."', '".$SUPElectronicMail."');";        //print($sql);        $result = $conn -> query($sql);        $SUPPartyID = $conn->insert_id;        //$SUPPartyID = 1; // TBD: temporar        $msg = $conn -> error;    }    if($CUSTPartyID == "" || $msg = "")    {        $sql = "INSERT INTO fast_customerparty VALUES (default, '".$CUSTPartyName."', ".$fast_client_id.", '".                $CUSTPartyTaxSchemeCompanyID."', '".$CUSTPartyTaxSchemeTaxScheme."', '".$CUSTPostalAddressStreetName."', '".                $CUSTPostalAddressCityName."', '".$CUSTPostalAddressPostalZone."', '".$CUSTPostalAddressCountrySubentity."', '".                $CUSTPostalAddressCountry."', '".$CUSTPartyLegalEntityRegistrationName."', '".                $CUSTPartyLegalEntityCompanyID."');";        print($sql);        $result = $conn -> query($sql);        $CUSTPartyID = $conn->insert_id;        //$CUSTPartyID = 1; // TBD: temporar        $msg = $conn -> error;    }            if($fast_invoice_id == "" || $fast_invoice_id == 0 || $msg = "")    {        //print("INSERT");        //////////////////////////////////////////////////////////////////////////////////////////        //                                  INSERT                                              //        //////////////////////////////////////////////////////////////////////////////////////////        $sql = "INSERT INTO fast_invoice VALUES (default, ".$fast_client_id.", '".$fast_reference."', '".$ID."', ".$SUPPartyID.", ".$CUSTPartyID.", "                . "'".$IssueDate."', '".$DueDate."', '".$Note."', '".$DocumentCurrencyCode."', '".$InvoicePeriodEndDate."', "                .$TaxAmount .", ".$LineExtensionAmount.", ".$TaxExclusiveAmount.", ".$TaxInclusiveAmount.", ".$PayableAmount.");";        //print($sql);        $result = $conn -> query($sql);        $fast_invoice_id = $conn->insert_id;        //print($fast_invoice_id);                $msg = "INSERT OK";    }}?><html lang="RO"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Generare XML pentru sistemul e-factura</title><meta name="description" content="Generare rapidă UBL pentru sistemul e-factura"/><!--link rel="shortcut icon" href="./favicon.ico" /--><link name="author" content="dataseed.info" /><link rel="stylesheet" type="text/css" href="./styles.css"><!--script type="text/javascript" src="./scripturi.js"></script--><script language=javascript>function Save(){    if(document.frmForm.ID.value === "")    //if(document.getElementsByName("ID").value === undefined)    {        alert("EROARE! Completați numărul facturii!");        document.frmForm.ID.focus();        return;    }    if(document.frmForm.IssueDate.value === "")    {        alert("EROARE! Completați data facturii!");        document.frmForm.IssueDate.focus();        return;    }    if(document.frmForm.SUPPayeeFinancialAccountID.value === "")    {        alert("EROARE! Completați IBAN-ul furnizorului!");        document.frmForm.SUPPayeeFinancialAccountID.focus();        return;    }        document.frmForm.hdnFor.value = "SAVE";    document.frmForm.submit();}function AddNew(){    //document.frmForm..value = "";    //document.getElementById("frmForm").reset();    var elements = frmForm.elements;    for(i=0; i<elements.length; i++)     {        field_type = elements[i].type.toLowerCase();        switch(field_type)        {            case "text":            case "number":            case "textarea":            case "hidden":                elements[i].value = "";                break;            case "select-one":            case "select-multi":                elements[i].selectedIndex = -1;                break;            default:                  break;        }    }    //alert(window.location.href);    //alert('fast_id=1');    txt = window.location.href;    res = txt.replace('fast_id=1', 'fast_id=');    //alert(res);    document.frmForm.action = res;    //document.frmForm.reset();    document.frmForm.hdnFor.value = "ADDNEW";    document.frmForm.submit();}function item(){    document.frmForm.ID.value = '<?php print($fast_invoice_id) ?>';    document.frmForm.action = "item.php";    document.frmForm.hdnFor.value = "ADDNEW";    document.frmForm.submit();}$ = function(id) {  return document.getElementById(id);}var show = function(id) {	$(id).style.display ='block';}var hide = function(id) {	$(id).style.display ='none';}</script></head><body><div class="header">    <h1><a href="./" class="header">&#127968; fastinvoice.ro</a>        &nbsp;&nbsp;>&nbsp; &#128196; Adăugare factură</div>    <div class="container"><div class="top_menu">        <a href="./">&#127968; Home</a>&nbsp;     | &nbsp;    <a href="./entityView.php?app=_system&table=seed_apps ">&#9881; Apps</a>&nbsp;     | &nbsp;         <a target="_blank" href="https://data-seed.tech/tutorial.php">&#128712; Help</a>          </div><br><br><div class="invoice"><form name='frmForm' method='post'><table class="form_table"><tr>    <td style="text-align:center;background-color: #e6f2ff" colspan="5">        <h1 style="font-size:16px">            FACTURA NR. &nbsp;            <input type="text" id="ID" name="ID" value="<?php print($ID) ?>" placeholder="Nr. fact." maxlength="100" style="width:80px;font-weight:bold;font-size:16px" title="Numărul facturii în evidențele dumneavoastră - acesta este de obicei transmis clientului ca Număr factură (ANAF: BT-1)">            &nbsp;&nbsp;            din data <input type="date" name="IssueDate" value="<?php print($IssueDate) ?>" title="Data emiterii facturii (ANAF: BT-2)" style="font-size:16px">        </h1>        <br/>    </td></tr><tr>    <td style="text-align:center" colspan="5">        <?php print($msg) ?>    </td></tr><tr>    <td>Moneda facturii - Codul monedei (ANAF: BT-5) *</td>    <td>        <select name="DocumentCurrencyCode">            <option value="RON" <?php if($DocumentCurrencyCode == "RON") {print("selected");} ?>>RON</option>            <option value="EUR" <?php if($DocumentCurrencyCode == "EUR") {print("selected");} ?>>EUR</option>        </select>    </td>    <td></td>    <td>Data scadenței *</td>    <td><input type="date" name="DueDate" value="<?php print($DueDate) ?>" title="Data la care trebuie efectuată plata (ANAF: BT-9)"></td></tr><tr>    <td style="font-weight:bold">Invoice fast_id 🔑 </td>    <td><input type="number" name="fast_invoice_id" value="<?php print($fast_invoice_id) ?>" style="width:50px;text-align: right;" readonly class="read_only"> hidden</td>    <td></td>    <td>fast_client id *</td>    <td>        <input type="number" name="fast_client_id" value="<?php print($fast_client_id) ?>" style="width:50px; text-align: right;"> hidden FastInvoice Client Id    </td></tr><tr>    <td style="text-align:center;background-color: #e6f2ff" colspan="2">        <h3>FURNIZOR &nbsp;                <?php        if($fast_client_id != "")        {            $query = "SELECT *                    FROM fast_supplierparty                    WHERE fast_client = ".$fast_client_id.";";            //print($query);            $result = $conn -> query($query);            ?>            <select name="fast_supplierparty">                <option value="" style="color:gray"> -- Furnizori salvați -- </option>                <?php                while($row = $result -> fetch_object())                {                ?>                <option value="<?php print($row->fast_id) ?>" <?php if($SUPPartyID == $row->fast_id) {print("selected");} ?>><?php print($row->PartyName) ?></option>                <?php                }                ?>            </select>        <?php        }        ?>            </h3>    </td>    <td>&nbsp;</td>    <td style="text-align:center;background-color: #e6f2ff" colspan="2">        <h3>CLIENT &nbsp;                <?php        if($fast_client_id != "")        {            $query = "SELECT *                    FROM fast_customerparty                    WHERE fast_client = ".$fast_client_id.";";            //print($query);            $result = $conn -> query($query);            ?>            <select name="fast_customerparty">                <option value="" style="color:gray"> -- Clienți salvați -- </option>                <?php                while($row = $result -> fetch_object())                {                ?>                <option value="<?php print($row->fast_id) ?>" <?php if($CUSTPartyID == $row->fast_id) {print("selected");} ?>><?php print($row->PartyName) ?></option>                <?php                }                ?>            </select>        <?php        }        ?>                    </h3>    </td></tr><tr>    <td>        Denumire furnizor:    </td>    <td>        <input type="text" name="SUPPartyName" value="<?php print($SUPPartyName) ?>" placeholder="Denumire furnizor" maxlength="100" style="width:200px">    </td>    <td>&nbsp;</td>    <td>        Denumire client:    </td>    <td>        <input type="text" name="CUSTPartyName" value="<?php print($CUSTPartyName) ?>" placeholder="Denumire client" maxlength="100" style="width:200px">    </td></tr><tr>    <td>        CUI:    </td>    <td>        <input type="text" name="SUPPartyTaxSchemeCompanyID" value="<?php print($SUPPartyTaxSchemeCompanyID) ?>" placeholder="ex. RO12345678" maxlength="10" style="width:200px">        &nbsp;        [<a target="_blank" title="Se autocompletează datele dacă compania este găsită în sistemul ANAF" href="#">Verifică în sistemul ANAF</a>]    </td>    <td>&nbsp;</td>    <td>        CUI:    </td>    <td>        <input type="text" name="CUSTPartyTaxSchemeCompanyID" value="<?php print($CUSTPartyTaxSchemeCompanyID) ?>" placeholder="ex. RO12345678" maxlength="10" style="width:200px">        &nbsp;        [<a target="_blank" title="Se autocompletează datele dacă compania este găsită în sistemul ANAF" href="#">Verifică în sistemul ANAF</a>]    </td></tr><tr>    <td>        Reg. Com.:    </td>    <td>        <input type="text" name="SUPPartyLegalEntityCompanyID" value="<?php print($SUPPartyLegalEntityCompanyID) ?>" placeholder="ex.  Fxx/1234/2023" maxlength="13" style="width:200px">    </td>    <td>&nbsp;</td>    <td>        Reg. Com.:    </td>    <td>        <input type="text" name="CUSTPartyLegalEntityCompanyID" value="<?php print($CUSTPartyLegalEntityCompanyID) ?>" placeholder="ex.  Jxx/1234/2023" maxlength="13" style="width:200px">    </td></tr><tr>    <td>        Adresa:    </td>    <td>        <?php        $query = "SELECT *                FROM fast_countrysubentity;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="SUPPostalAddressCountrySubentity">            <option value="" style="color:gray"> -- Județ -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->CountrySubentity) ?>" <?php if($SUPPostalAddressCountrySubentity == $row->CountrySubentity) {print("selected");} ?>><?php print($row->Subentity) ?></option>            <?php            }            ?>        </select>                <input type="text" name="SUPPostalAddressCityName" value="<?php print($SUPPostalAddressCityName) ?>" placeholder="Localitate" maxlength="100" style="width:200px"><br/>        <input type="text" name="SUPPostalAddressStreetName" value="<?php print($SUPPostalAddressStreetName) ?>" placeholder="Strada" maxlength="300" style="width:300px">    </td>    <td>&nbsp;</td>    <td>        Adresa:    </td>    <td>        <?php        $query = "SELECT *                FROM fast_countrysubentity;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="CUSTPostalAddressCountrySubentity">            <option value="" style="color:gray"> -- Județ -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->CountrySubentity) ?>" <?php if($CUSTPostalAddressCountrySubentity == $row->CountrySubentity) {print("selected");} ?>><?php print($row->Subentity) ?></option>            <?php            }            ?>        </select>                <input type="text" name="CUSTPostalAddressCityName" value="<?php print($CUSTPostalAddressCityName) ?>" placeholder="Localitate" maxlength="100" style="width:200px"><br/>        <input type="text" name="CUSTPostalAddressStreetName" value="<?php print($CUSTPostalAddressStreetName) ?>" placeholder="Strada" maxlength="300" style="width:300px">    </td></tr><tr>    <td>        IBAN / Metoda de plată:    </td>    <td>        <input type="text" name="SUPPayeeFinancialAccountID" value="<?php print($SUPPayeeFinancialAccountID) ?>" placeholder="IBAN: ex. ROxxBANKxxxxxxxxxxxxxxxx" maxlength="20" style="width:200px">                <?php        $query = "SELECT *                FROM fast_paymentmeans;";        //print($query);        $result = $conn -> query($query);        ?>        <select name="SUPPaymentMeansCode">            <option value="" style="color:gray"> -- Metoda de plată -- </option>            <?php            while($row = $result -> fetch_object())            {            ?>            <option value="<?php print($row->PaymentMeanCode) ?>" <?php if($SUPPaymentMeansCode == $row->PaymentMeanCode) {print("selected");} ?>><?php print($row->PaymentMeanCode . " - " . $row->PaymentMean) ?></option>            <?php            }            ?>        </select>            </td>    <td colspan="3">&nbsp;</td></tr><tr>    <td>        Plătitor de TVA    </td>    <td>        <select name="SUPPlatitorTVA">            <option value="1" <?php if($SUPPlatitorTVA == 1) {print("selected");} ?>>DA</option>            <option value="0" <?php if($SUPPlatitorTVA == 0) {print("selected");} ?>>NU</option>        </select>    </td>    <td>&nbsp;</td>    <td>Observații</td>    <td>        <textarea name="Note_varchar9" rows="2" cols="40" placeholder="Aici se pot pune orice informații relevante: cursul valutar etc. Ex. 1 EURO = 4,9746 Lei"><?php print($Note); ?></textarea>    </td></tr> <tr>    <td colspan="5">&nbsp;</td></tr><tr>    <td>Valoare netă *</td>    <td><input type="number" name="LineExtensionAmount" value="<?php print($LineExtensionAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Suma valorilor nete ale liniilor facturii"></td>    <td></td>    <td>Valoarea totală a facturii fără TVA *</td>    <td><input type="number" name="TaxExclusiveAmount" value="<?php print($TaxExclusiveAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea totală a facturii fără TVA"></td></tr><tr>    <td>Valoarea totală a facturii cu TVA *</td>    <td><input type="number" name="TaxInclusiveAmount" value="<?php print($TaxInclusiveAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea totală a facturii cu TVA"></td>    <td></td>    <td>Valoarea TVA totală *</td>    <td><input type="number" name="TaxAmount" value="<?php print($TaxAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Valoarea TVA totală a facturii în moneda de contabilizare"></td></tr><tr>    <td>Total de plată *</td>    <td><input type="number" name="PayableAmount" value="<?php print($PayableAmount);?>" style="width:100px;text-align: right;" readonly class="read_only" title="Total de plată"></td>    <td colspan=""3></td>    </tr><tr>    <td colspan="5">&nbsp;</td></tr><tr>    <td colspan="5">        <table class="xml_table">            <tr>                <th>Nr. crt. (ID)</th>                <th>Denumire (ItemName)</th>                <th>Cantitate (InvoicedQuantity)</th>                <th>U.M. (InvoicedQuantityUnitCode)</th>                <th>Preț unitar (PriceAmount)</th>                <th>LineExtensionAmount</th>                <th>ClassifiedTaxCategoryID</th>                <th>ClassifiedTaxCategoryPercent</th>                <th>ClassifiedTaxCategoryTaxSchemeID</th>            </tr>            <tr>                <td><a target="_self" title="Go to [fast_invoiceline]" href="#">↪ 1</a></td>                <td>ItemName</td>                <td>InvoicedQuantity</td>                <td>InvoicedQuantityUnitCode</td>                <td>PriceAmount</td>                <td>LineExtensionAmount</td>                <td>ClassifiedTaxCategoryID</td>                <td>ClassifiedTaxCategoryPercent</td>                <td>ClassifiedTaxCategoryTaxSchemeID</td>            </tr>        </table>                [+] <a href="#" onclick="item()">Adaugă item</a><br/><br/><br/>        </td></tr></table>                <br /><br />    <input type="button" name="btnAddNew" onclick="AddNew()" VALUE=" Golește formularul  &#128396;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <input type="button" name="btnSave" class='button_default' onclick='Save()' value=' Salvează factura  &#128190;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                <input type="hidden" name="hdnFor">    <input type="hidden" name="fast_id"></form><br/><br/><br/></div></div>    <a href="#" onclick="show('popup1')">Adaugă item</a><div class="popup" id="popup1">  <p>This is a popup!</p>  <p>Overlay uses <b>box-shadow</b>.</p>	<p>(Doesn't block elements on background)</p>  <a href="#" onclick="hide('popup1')">Ok!</a></div></body></html>